# 人设弹窗快速测试指南

## 🚀 快速开始

### 第一步：启动服务
```bash
npm run dev
```

### 第二步：访问 Admin
```
http://localhost:3000/admin
```
点击"人设管理" Tab

## ✅ 测试场景

### 场景1：添加人设（AI 生成模式）

1. 点击"添加人设"按钮
2. 在弹窗中填写：
   ```
   人设名称: 泰国科技爱好者
   目标市场: 泰国
   人设描述: 泰国
   类目: 3C数码
   生成方式: ✓ AI智能生成
   
   人设描述:
   25-30岁的泰国年轻人，热爱科技产品，
   经常在 TikTok 和 YouTube 上观看科技评测，
   注重性价比，喜欢在线购物
   ```
3. 点击"AI生成并保存"
4. ✅ 等待几秒，弹窗关闭
5. ✅ 列表自动刷新，看到新人设

**预期结果：**
- ✅ 无报错
- ✅ 人设保存成功
- ✅ 显示完整信息（年龄、性别、职业、特征）

### 场景2：添加人设（手动输入模式）

1. 点击"添加人设"按钮
2. 填写基本信息：
   ```
   人设名称: 越南年轻妈妈
   目标市场: 越南
   类目: 个护
   生成方式: ◯ 手动输入
   ```
3. 填写详细信息：
   ```
   年龄段: 28-35
   性别: 女性
   职业: 家庭主妇
   收入水平: 中等收入
   地区: 河内、胡志明市
   
   购买习惯: 注重产品安全，关注母婴产品
   使用场景: 家庭日常护理
   
   价值观: 家庭, 健康, 安全
   痛点: 担心产品质量, 价格敏感
   ```
4. 点击"保存人设"
5. ✅ 弹窗关闭，列表更新

**预期结果：**
- ✅ 所有手动输入的数据都正确保存
- ✅ 列表显示完整信息

### 场景3：编辑现有人设

1. 找到"马来科技达人"
2. 点击编辑按钮（铅笔图标）
3. 弹窗打开，显示现有数据
4. 修改：
   ```
   人设名称: 马来科技达人 Pro
   目标市场: 新加坡
   ```
5. 点击"更新人设"
6. ✅ 弹窗关闭，列表更新

**预期结果：**
- ✅ 弹窗正确显示原有数据
- ✅ 修改后保存成功
- ✅ 列表显示更新后的名称和信息

### 场景4：商品关联

1. 添加新人设
2. 选择类目："美妆"
3. 等待商品列表加载
4. 选择商品：（如果有的话）或"不关联商品"
5. ✅ 无 Select 空值报错
6. 保存成功

**预期结果：**
- ✅ 商品列表正常加载
- ✅ 可以选择"不关联商品"
- ✅ 无报错信息

### 场景5：取消操作

1. 点击"添加人设"
2. 填写一些信息
3. 点击"取消"
4. ✅ 弹窗关闭
5. 点击"添加人设"
6. ✅ 弹窗为空白状态（上次填写的内容已清除）

## 🐛 常见问题排查

### 问题1: 弹窗不打开
- 检查浏览器控制台是否有错误
- 刷新页面重试

### 问题2: Select.Item 报错
- 确认修复已生效
- 查看 `PersonaFormModal.tsx` 第378行是否使用了 `value={productId || 'none'}`

### 问题3: AI 生成失败
- 检查网络连接
- 查看后端日志
- 确认 AI API 配置正确

### 问题4: 数据不显示或显示"未知"
- 刷新列表
- 查看 `PersonaManagement.tsx` 是否有数据兼容逻辑
- 运行 `npx tsx scripts/debug-persona-structure.ts` 查看数据结构

## 📸 预期界面

### 弹窗（AI 生成模式）
```
┌────────────────────── 创建人设 ─────────────────────────┐
│                                                          │
│ 人设名称 *      [马来科技达人           ]  目标市场 *   │
│                                          [马来西亚 ▼]    │
│                                                          │
│ 人设描述        [简单描述...                        ]   │
│                                                          │
│ 类目 *          [3C数码 ▼]       关联商品              │
│                                   [不关联商品 ▼]         │
│                                                          │
│ 生成方式:  ● AI智能生成  ◯ 手动输入                    │
│                                                          │
│ 人设描述（帮助AI更好地生成）                             │
│ ┌────────────────────────────────────────────────────┐  │
│ │ 描述目标用户特征、行为习惯、偏好等...              │  │
│ │                                                    │  │
│ └────────────────────────────────────────────────────┘  │
│                                                          │
│                           [取消]  [AI生成并保存 ✨]     │
└──────────────────────────────────────────────────────────┘
```

### 弹窗（手动输入模式）
```
┌────────────────────── 创建人设 ─────────────────────────┐
│                                                          │
│ 人设名称 *      [越南年轻妈妈           ]  目标市场 *   │
│                                          [越南 ▼]        │
│                                                          │
│ 生成方式:  ◯ AI智能生成  ● 手动输入                    │
│                                                          │
│ ──────────── 基础信息 ────────────                       │
│ 年龄段 [28-35   ]  性别 [女性      ]                    │
│ 职业   [家庭主妇]  收入 [中等收入  ]                    │
│ 地区   [河内、胡志明市                ]                 │
│                                                          │
│ ──────────── 行为特征 ────────────                       │
│ 购买习惯 [注重产品安全，关注母婴产品  ]                 │
│ ...                                                      │
│                                                          │
│ ──────────── 心理特征 ────────────                       │
│ 价值观   [家庭, 健康, 安全            ]                 │
│ 痛点     [担心产品质量, 价格敏感      ]                 │
│                                                          │
│                           [取消]  [保存人设 ✨]          │
└──────────────────────────────────────────────────────────┘
```

## ✅ 完成标志

全部功能正常应该：

- [x] 可以打开添加人设弹窗
- [x] 可以选择类目和目标市场
- [x] AI 生成模式可以生成人设
- [x] 手动输入模式可以保存人设
- [x] 可以编辑现有人设
- [x] 商品选择无报错
- [x] 取消操作正常工作
- [x] 新创建/编辑的人设在列表中正确显示

---

**测试完成请反馈结果！** 🙏

