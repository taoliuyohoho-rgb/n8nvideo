# 竞品分析推荐引擎UI优化

## 🎯 优化目标

1. **简化交互** - 取消"查看备选"按钮，点击即展开下拉
2. **隐藏技术细节** - 不显示"精排/粗排/探索"，改为星级推荐指数
3. **Prompt管理** - 支持预览完整内容和编辑

## 📋 优化前后对比

### 优化前 ❌
```
推荐的AI配置              [查看全部备选]
━━━━━━━━━━━━━━━━━━━━━━━
AI模型: gemini/gemini-pro
Prompt: 竞品分析-标准模板

[点击"查看全部备选"才能看到]
模型候选（点击选择）
  ✓ gemini/gemini-pro [精排]
    分数: 0.85
  doubao/pro [精排]
    分数: 0.78
  gpt-4 [粗排]
    分数: 0.72
```

**问题**：
- 需要额外点击"查看备选"按钮
- 暴露了"精排/粗排/探索"技术术语
- 分数0.85对用户无意义
- Prompt无法预览完整内容

### 优化后 ✅
```
推荐的AI配置
━━━━━━━━━━━━━━━━━━━━━━━
AI模型
┌──────────────────────────────┐
│ gemini/gemini-pro ★★★★★   ▼ │ ← 点击展开
└──────────────────────────────┘

[点击后自动展开下拉]
┌──────────────────────────────┐
│ ✓ gemini/gemini-pro ★★★★★   │ ← 当前选中
│   语言匹配+JSON+低价          │
│───────────────────────────────│
│   doubao/pro ★★★★☆            │
│   中文优化+极低价              │
│───────────────────────────────│
│   gpt-4 ★★★☆☆                 │
│   综合性能最强                │
└──────────────────────────────┘

Prompt模板
┌──────────────────────────────┐
│ 竞品分析-标准模板 ★★★★★   ▼ │
└──────────────────────────────┘

[点击后展开，每项有"预览"按钮]
┌──────────────────────────────┐
│ ✓ 竞品分析-标准模板 ★★★★★   │
│   性能0.85 成功率0.90    [预览]│
│───────────────────────────────│
│   竞品分析-快速版 ★★★★☆      │
│   性能0.80 成功率0.88    [预览]│
└──────────────────────────────┘

💡 已自动推荐最优配置（星级表示推荐指数），点击可切换其他选项
```

**优势**：
- ✅ 直接点击展开，无需额外按钮
- ✅ 星级（★★★★★）直观表示推荐程度
- ✅ 隐藏技术术语，对用户友好
- ✅ 每个Prompt有"预览"按钮

## 🌟 星级推荐指数逻辑

### 计算规则
```typescript
function getRecommendationStars(score, type) {
  if (type === 'fine-top') {    // 精排（系统最推荐）
    return 4-5星  // 根据score映射到4-5星
  } else if (type === 'coarse-top') {  // 粗排（备选）
    return 3-4星
  } else {  // 探索（新选项）
    return 1-3星
  }
}
```

### 星级含义（对用户）
| 星级 | 含义 | 实际类型 |
|------|------|---------|
| ★★★★★ | 强烈推荐 | 精排top，score高 |
| ★★★★☆ | 推荐 | 精排或粗排top |
| ★★★☆☆ | 可选 | 粗排 |
| ★★☆☆☆ | 探索选项 | 探索新模型 |
| ★☆☆☆☆ | 试验选项 | 探索低分 |

### 示例
```
精排1st: score=0.85, type='fine-top' → ★★★★★ (5星)
精排2nd: score=0.78, type='fine-top' → ★★★★☆ (4星)
粗排1st: score=0.72, type='coarse-top' → ★★★☆☆ (3星)
探索1st: score=0.50, type='explore' → ★★☆☆☆ (2星)
```

## 🔍 Prompt预览和编辑

### 预览功能
```
[点击Prompt下拉项的"预览"按钮]
↓
┌─────────────────────────────────────┐
│ Prompt预览与编辑                  ✕ │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 请分析以下竞品信息，提取关键信息： │ │
│ │                                   │ │
│ │ 1. 卖点（产品特性、优势...）      │ │
│ │ 2. 痛点（用户问题、困扰...）      │ │
│ │ 3. 目标受众（用户画像...）        │ │
│ │ ...                              │ │
│ │ (完整Prompt内容，可编辑)          │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ [保存修改] [关闭]                    │
└─────────────────────────────────────┘
```

### 编辑功能
- **可编辑**：Textarea支持修改Prompt内容
- **保存**：点击"保存修改"应用到本次分析
- **临时修改**：仅本次使用，不影响库中的模板
- **未来扩展**：可支持"另存为新模板"

## 💻 技术实现

### 新增状态
```typescript
const [showModelDropdown, setShowModelDropdown] = useState(false)
const [showPromptDropdown, setShowPromptDropdown] = useState(false)
const [showPromptPreview, setShowPromptPreview] = useState(false)
const [previewPromptId, setPreviewPromptId] = useState<string | null>(null)
const [editingPrompt, setEditingPrompt] = useState<string>('')
```

### 下拉交互
```typescript
// 点击模型/Prompt输入框展开下拉
<div onClick={() => setShowModelDropdown(!showModelDropdown)}>
  <div className="p-2 border rounded">
    gemini/gemini-pro ★★★★★ ▼
  </div>
  
  {showModelDropdown && (
    <div className="absolute dropdown">
      {candidates.map((c, i) => (
        <div onClick={() => handleSelectCandidate('model', i)}>
          {c.title} {stars}
        </div>
      ))}
    </div>
  )}
</div>
```

### 星级计算
```typescript
const getRecommendationStars = (score, type) => {
  if (type === 'fine-top') {
    return Math.min(5, Math.max(4, Math.round(score * 5)))
  } else if (type === 'coarse-top') {
    return Math.min(4, Math.max(3, Math.round(score * 4)))
  } else {
    return Math.min(3, Math.max(1, Math.round(score * 3)))
  }
}
```

### Prompt获取API
```typescript
GET /api/admin/prompts/[id]

返回：
{
  id: "xxx",
  name: "竞品分析-标准模板",
  content: "请分析以下竞品信息...",
  variables: {...},
  performance: 0.85,
  successRate: 0.90
}
```

## 📊 用户体验提升

### 1. 交互更直观
- **0步操作**：自动获取推荐
- **1步操作**：点击模型/Prompt直接展开下拉
- **无需学习**：星级推荐指数通用易懂

### 2. 信息更友好
```
技术术语 → 用户友好
━━━━━━━━━━━━━━━━━
精排      → ★★★★★ (强烈推荐)
粗排      → ★★★☆☆ (可选)
探索      → ★★☆☆☆ (探索选项)
分数0.85  → ★★★★★ (5星)
```

### 3. Prompt可控
- **透明**：可预览完整内容
- **灵活**：可临时编辑修改
- **安全**：不影响原模板

## 🎨 视觉设计

### 颜色方案
```
推荐配置：
- 背景：bg-blue-50（淡蓝色）
- 边框：border-blue-200
- 标题：text-blue-900

下拉选项：
- 悬停：hover:bg-blue-50
- 选中：bg-blue-50
- 边框：border-blue-400

星级：
- 已选：text-yellow-400 (★)
- 未选：text-gray-300 (☆)

完成状态：
- 背景：bg-green-50（淡绿色）
- 边框：border-green-200
```

### 布局
```
推荐配置区域（蓝色背景）
┌────────────────────────┐
│ 推荐的AI配置           │
│                        │
│ AI模型                 │
│ [下拉选择器]           │
│                        │
│ Prompt模板             │
│ [下拉选择器]           │
│                        │
│ 💡 提示文字            │
└────────────────────────┘

下拉列表（白色背景，阴影）
┌────────────────────────┐
│ ✓ 选项1 ★★★★★         │
│   说明文字             │
│────────────────────────│
│   选项2 ★★★★☆ [预览]  │
│   说明文字             │
└────────────────────────┘
```

## ✅ 验收标准

### 功能验收
- [ ] 点击AI模型输入框展开下拉
- [ ] 点击Prompt输入框展开下拉
- [ ] 选中候选项后下拉自动关闭
- [ ] 星级正确显示（精排4-5星，粗排3-4星，探索1-3星）
- [ ] 点击"预览"按钮打开弹窗
- [ ] Prompt内容可编辑
- [ ] 保存修改生效

### UI验收
- [ ] 不显示"查看备选"按钮
- [ ] 不显示"精排/粗排/探索"标签
- [ ] 星级图标美观（★☆）
- [ ] 下拉菜单美观（阴影、圆角）
- [ ] 预览弹窗居中、可滚动

### 交互验收
- [ ] 点击空白处关闭下拉
- [ ] 点击弹窗外关闭弹窗
- [ ] 下拉选项hover高亮
- [ ] 当前选中项高亮显示

## 🚀 测试步骤

1. 启动服务：`npm run dev`
2. 访问：`http://localhost:3000/dashboard?tab=video`
3. 选择商品，输入竞品信息
4. 等待1秒，推荐配置出现
5. **测试模型下拉**：
   - 点击"AI模型"输入框
   - 观察下拉列表展开
   - 观察星级显示
   - 点击某个选项
   - 观察下拉自动关闭
6. **测试Prompt下拉**：
   - 点击"Prompt模板"输入框
   - 观察下拉列表展开
   - 点击"预览"按钮
   - 观察弹窗打开，内容显示
   - 编辑内容
   - 点击"保存修改"
7. 点击"AI解析"，验证使用选中的配置

## 📝 关键文件

- `components/CompetitorAnalysis.tsx` ⭐ - 统一组件（已优化UI）
- `app/api/admin/prompts/[id]/route.ts` ⭐ - Prompt获取API（新增）
- `docs/COMPETITOR_UI_OPTIMIZATION.md` - 本文档

## 🎉 总结

### 核心改进
1. **简化交互** - 取消额外按钮，点击即展开
2. **用户友好** - 星级推荐指数，隐藏技术术语
3. **Prompt管理** - 预览+编辑，完全可控

### 用户价值
- **更快**：少一步操作
- **更懂**：星级直观，无需理解技术术语
- **更灵活**：Prompt可临时调整

### 技术价值
- **反馈收集不变**：用户选择仍会记录
- **推荐逻辑不变**：后端评分体系不变
- **仅UI优化**：降低用户学习成本

