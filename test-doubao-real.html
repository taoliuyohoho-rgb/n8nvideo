<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>豆包真实功能测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px; white-space: pre-wrap; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>豆包真实功能测试</h1>
    <p><strong>注意：</strong>这个测试需要真实的豆包API Key才能工作</p>
    
    <div class="test-section">
        <h3>1. 豆包连接测试</h3>
        <input type="password" id="doubaoApiKey" placeholder="请输入豆包API Key" />
        <button onclick="testDoubaoConnection()">测试豆包连接</button>
        <div id="connectionResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. 豆包文本生成测试</h3>
        <textarea id="testPrompt" placeholder="请输入测试提示词" rows="3">请写一个关于智能手机的简短介绍</textarea>
        <button onclick="testDoubaoGeneration()">测试文本生成</button>
        <div id="generationResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. 豆包视频脚本生成测试</h3>
        <button onclick="testVideoScriptGeneration()">测试视频脚本生成</button>
        <div id="scriptResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. 豆包营销文案生成测试</h3>
        <button onclick="testMarketingCopy()">测试营销文案生成</button>
        <div id="marketingResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3003';

        async function testDoubaoConnection() {
            const apiKey = document.getElementById('doubaoApiKey').value;
            if (!apiKey) {
                document.getElementById('connectionResult').innerHTML = 
                    '<div class="error">❌ 请输入API Key</div>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/ai/doubao?apiKey=${encodeURIComponent(apiKey)}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('connectionResult').innerHTML = 
                        `<div class="success">✅ 豆包连接成功！</div><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    document.getElementById('connectionResult').innerHTML = 
                        `<div class="error">❌ 豆包连接失败: ${data.error}</div>`;
                }
            } catch (error) {
                document.getElementById('connectionResult').innerHTML = 
                    `<div class="error">❌ 连接测试失败: ${error.message}</div>`;
            }
        }

        async function testDoubaoGeneration() {
            const apiKey = document.getElementById('doubaoApiKey').value;
            const prompt = document.getElementById('testPrompt').value;
            
            if (!apiKey) {
                document.getElementById('generationResult').innerHTML = 
                    '<div class="error">❌ 请输入API Key</div>';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/ai/doubao`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: prompt,
                        apiKey: apiKey
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('generationResult').innerHTML = 
                        `<div class="success">✅ 豆包文本生成成功！</div><pre>${data.data.content}</pre>`;
                } else {
                    document.getElementById('generationResult').innerHTML = 
                        `<div class="error">❌ 豆包文本生成失败: ${data.error}</div>`;
                }
            } catch (error) {
                document.getElementById('generationResult').innerHTML = 
                    `<div class="error">❌ 生成测试失败: ${error.message}</div>`;
            }
        }

        async function testVideoScriptGeneration() {
            const apiKey = document.getElementById('doubaoApiKey').value;
            
            if (!apiKey) {
                document.getElementById('scriptResult').innerHTML = 
                    '<div class="error">❌ 请输入API Key</div>';
                return;
            }

            const productInfo = {
                name: "iPhone 15 Pro",
                category: "智能手机",
                sellingPoints: ["钛金属机身", "A17 Pro芯片", "专业级摄像头"],
                targetAudience: "科技爱好者和专业人士",
                targetCountry: "中国"
            };

            try {
                const response = await fetch(`${API_BASE}/api/ai/doubao`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: `请为以下产品生成一个吸引人的视频脚本：

产品名称：${productInfo.name}
产品类别：${productInfo.category}
卖点：${productInfo.sellingPoints.join(', ')}
目标受众：${productInfo.targetAudience}
目标国家：${productInfo.targetCountry}

请生成一个30秒的视频脚本，包含：
1. 开头吸引注意力的hook
2. 产品介绍和卖点展示
3. 行动号召

脚本要符合${productInfo.targetCountry}的营销习惯和语言风格。`,
                        apiKey: apiKey
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('scriptResult').innerHTML = 
                        `<div class="success">✅ 豆包视频脚本生成成功！</div><pre>${data.data.content}</pre>`;
                } else {
                    document.getElementById('scriptResult').innerHTML = 
                        `<div class="error">❌ 豆包视频脚本生成失败: ${data.error}</div>`;
                }
            } catch (error) {
                document.getElementById('scriptResult').innerHTML = 
                    `<div class="error">❌ 脚本生成测试失败: ${error.message}</div>`;
            }
        }

        async function testMarketingCopy() {
            const apiKey = document.getElementById('doubaoApiKey').value;
            
            if (!apiKey) {
                document.getElementById('marketingResult').innerHTML = 
                    '<div class="error">❌ 请输入API Key</div>';
                return;
            }

            const productInfo = {
                name: "MacBook Pro M3",
                description: "搭载M3芯片的专业笔记本电脑",
                targetAudience: "创意工作者和专业人士",
                platform: "小红书"
            };

            try {
                const response = await fetch(`${API_BASE}/api/ai/doubao`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: `请为以下产品生成${productInfo.platform}平台的营销文案：

产品名称：${productInfo.name}
产品描述：${productInfo.description}
目标受众：${productInfo.targetAudience}
发布平台：${productInfo.platform}

请生成：
1. 吸引人的标题
2. 产品介绍文案
3. 行动号召

文案要符合${productInfo.platform}平台的特点和用户习惯。`,
                        apiKey: apiKey
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('marketingResult').innerHTML = 
                        `<div class="success">✅ 豆包营销文案生成成功！</div><pre>${data.data.content}</pre>`;
                } else {
                    document.getElementById('marketingResult').innerHTML = 
                        `<div class="error">❌ 豆包营销文案生成失败: ${data.error}</div>`;
                }
            } catch (error) {
                document.getElementById('marketingResult').innerHTML = 
                    `<div class="error">❌ 营销文案生成测试失败: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
