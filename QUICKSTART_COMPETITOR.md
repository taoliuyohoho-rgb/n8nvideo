# 竞品分析模块 - 快速启动指南

## 🎯 三个问题已全部解决

### ✅ 问题1: Admin和工作台UI统一
- 创建了统一组件 `components/CompetitorAnalysis.tsx`
- Dashboard已使用统一组件
- UI样式完全一致

### ✅ 问题2: 推荐引擎反馈模块
- "查看备选"按钮
- 6个候选项（精排2+粗排2+探索2）
- 点击候选项记录反馈

### ✅ 问题3: 痛点相关性判断
- AI Prompt添加相关性指令
- 关键词过滤（abc, test, xxx等）
- 传递商品名称进行匹配

## 🚀 立即测试（3步）

### 1. 启动服务
```bash
cd /Users/liutao/cursor/n8nvideo
npm run dev
```

### 2. 测试Dashboard竞品分析
访问：`http://localhost:3000/dashboard?tab=video`

**测试步骤**：
1. 选择商品："蓝牙耳机"
2. 滚动到"竞品分析"卡片
3. **测试相关性过滤**：
   - 输入 "abc test 123" → 点击"AI解析" → 应该提示"输入内容与商品无关"或返回空
4. **测试正常解析**：
   - 输入竞品文本（如"降噪蓝牙耳机，40小时续航"）
   - 点击"AI解析"
   - 查看卖点/痛点标签
5. **测试反馈收集**：
   - 点击"查看备选"按钮
   - 观察6个候选项（精排/粗排/探索标签）
   - 点击任意候选项
   - 应显示"已记录您的选择"

### 3. 验证数据库
```bash
# 查看反馈记录
sqlite3 prisma/dev.db "SELECT * FROM reco_feedback ORDER BY createdAt DESC LIMIT 5;"

# 应该看到类似：
# id | decisionId | feedbackType | chosenCandidateId | createdAt
# xxx | yyy | model | doubao-pro | 2025-10-26...
```

## 📸 预期效果截图说明

### 默认视图（简洁）
```
┌─────────────────────────────────────┐
│ 竞品分析                             │
├─────────────────────────────────────┤
│ [输入框：粘贴竞品文本/链接/图片]     │
│ [已粘贴图片预览]                     │
│ [AI解析按钮]                         │
├─────────────────────────────────────┤
│ 使用的AI模型: gemini/gemini-pro      │
│ 使用的Prompt: 竞品分析-标准模板      │
│ [查看备选] ← 点击展开                │
├─────────────────────────────────────┤
│ 卖点 (12)                            │
│ [降噪功能] [40h续航] [HiFi音质]...   │
│ 痛点 (5)                             │
│ [续航不足] [音质差] [佩戴不舒适]...  │
└─────────────────────────────────────┘
```

### 展开备选项（反馈收集）
```
┌─────────────────────────────────────┐
│ 📊 模型备选（点击选择反馈）          │
├─────────────────────────────────────┤
│ ✓ gemini/gemini-pro [精排]          │ ← 当前使用
│   分数0.85 | 语言匹配+JSON+低价      │
├─────────────────────────────────────┤
│   doubao/pro [精排]                  │ ← 可点击反馈
│   分数0.78 | 中文优化+极低价         │
├─────────────────────────────────────┤
│   openai/gpt-4 [粗排]                │
│   分数0.72 | 综合性能最强           │
├─────────────────────────────────────┤
│   claude/opus [粗排]                 │
│   分数0.70 | 推理能力强             │
├─────────────────────────────────────┤
│   deepseek/chat [探索]               │
│   分数0.50 | 探索新模型              │
├─────────────────────────────────────┤
│   moonshot/v1 [探索]                 │
│   分数0.45 | 探索新模型              │
└─────────────────────────────────────┘
```

## ⚠️ 测试注意事项

### 相关性过滤测试
**应该被过滤的输入**：
- ❌ "abc" → 空数组
- ❌ "test 123" → 空数组
- ❌ "xxx 测试" → 空数组
- ❌ 过短输入（<10字） → 空数组

**应该正常解析的输入**：
- ✅ "降噪蓝牙耳机，40小时超长续航" → 正常提取卖点/痛点
- ✅ 竞品商详文本 → 正常提取
- ✅ 粘贴的商品图片 → 正常提取

### 候选项展示条件
- ✅ API调用时传递 `returnCandidates: true`（统一组件已自动传递）
- ✅ 推荐引擎返回候选项
- ✅ 点击"查看备选"才展开

## 🔧 Admin中使用统一组件（待添加）

如果需要在Admin中也使用统一竞品分析，只需：

```typescript
// app/admin/page.tsx 中某个Tab

import { CompetitorAnalysis } from '@/components/CompetitorAnalysis'

// 在合适的位置添加
<CompetitorAnalysis
  productId={selectedProductId}
  onSuccess={(result) => {
    // 刷新Admin数据
    loadProducts()
    alert('竞品分析成功')
  }}
/>
```

## 📚 详细文档

- **完整实现说明**: `docs/FINAL_IMPLEMENTATION.md`
- **回答所有问题**: `docs/COMPETITOR_UNIFIED_FINAL.md`
- **反馈闭环设计**: `docs/COMPETITOR_FEEDBACK_LOOP.md`
- **架构文档**: `docs/COMPETITOR_ANALYSIS_UNIFIED.md`

## 💡 关键点总结

1. **统一组件**: 一个组件两处用，修改一处两处同步
2. **推荐引擎**: AI模型和Prompt动态选择，不硬编码
3. **反馈收集**: 6个候选项，收集用户偏好
4. **相关性过滤**: 商品名+关键词+AI指令，三重过滤

## 🎉 完成！

三个问题已全部解决，现在可以：
1. 启动服务测试
2. 在Admin中添加统一组件（可选）
3. 观察反馈数据积累
4. 后续实现自动调优

祝您测试顺利！🚀

